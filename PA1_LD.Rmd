---
title: "Reproducible Research: Peer Assessment 1"
author: "Laura"
Date: "June 27, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading and preprocessing the data

After loading the data into R I preped the data:  
- Looked to make sure the classes were set correctly.
- Set the date variable to a as.Date factor.
- Obtained steps/day using dply and stored data in new variable (actSummary).

```{r echo=TRUE, result='hide'}
act <- read.csv("/Users/daniell2/Desktop/Data_Specialization/RepData_PeerAssessment1/activity.csv")
act$date <- as.Date(act$date)
act$steps <- as.numeric(act$steps)

library(dplyr)
actSummary <- group_by(act, date) %>%
    summarize(totalSteps = sum(steps), meanSteps=mean(steps), medianSteps=median(steps))

```


## What is mean total number of steps taken per day?

A histogram of the total number of steps/day. 
```{r}
library(ggplot2)
myMean <- mean(actSummary$totalSteps, na.rm=T)
myMedian <- median(actSummary$totalSteps, na.rm=T)

g <- ggplot(actSummary, aes(x=totalSteps), na.rm=T)
g + geom_histogram(na.rm=T, bins=25) +
    geom_vline(xintercept=(myMean), linetype="solid", size=1, col = "green") +
    geom_vline(xintercept=(myMedian), linetype="dashed", size=1, col="red") +
    labs(title="Histogram of Steps", x="Steps/Day", y="Count") 


```

**Figure 1: Histogram of average steps by time interval**. The solid green line is the mean (`r myMean`) and the dotted red is the median (`r myMedian`)


## What is the average daily activity pattern?
Below is a graph of a time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis).


```{r}
actInterval <- group_by(act, interval) %>% 
    summarize(meanSteps=mean(steps, na.rm=T))
max = max(actInterval$meanSteps)
maxStepInterval <- filter(actInterval, meanSteps > 206.1)
maxStepInterval<-as.data.frame(maxStepInterval)

plot(actInterval$interval, actInterval$meanSteps, type="l", xlab="Interval", ylab="Steps", col = "42", main= "Average Daily Activity Pattern")
abline(v = maxStepInterval$interval, col = "purple", lwd = "3")
```

**Figure 2: Average daily step pattern**. The purple line is the 5-minute interval that contains the most step (`r maxStepInterval`)

## Imputing missing values

```{r number_NAs}
missing <-sum(is.na(act$steps))
```
The total number of missing values is `r missing`.

I imputed the data using the [MICE package](https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach/).

```{r imputed_data, cache=TRUE, echo=TRUE, results='hide'}
library(mice)
imputed<-mice(act, meth='pmm')
completedData <- complete(imputed, 1)

impSummary <- group_by(completedData, date) %>%
    summarize(totalSteps = sum(steps), meanSteps=mean(steps), medianSteps=median(steps))

impMyMean <- mean(impSummary$totalSteps, na.rm=T)
impMyMedian <- median(impSummary$totalSteps, na.rm=T)
```

```{r plot_imputed}
g <- ggplot(impSummary, aes(x=totalSteps), na.rm=T)
g + geom_histogram(na.rm=T, bins=25) +
    geom_vline(xintercept=(impMyMean), linetype="solid", size=1, col = "green") +
    geom_vline(xintercept=(impMyMedian), linetype="dashed", size=1, col="red") +
    labs(title="Histogram of Steps", x="Steps/Day", y="Count") 

```
  
**Figure 3: Histogram of average steps by time interval using imputed data**. The solid green line is the mean (`r myMean`) and the dotted red is the median (`r myMedian`)


There are only slight differences in the mean and median between the imputed and nonimputed data. An explanation for this could be that given the large number of intervals with zero steps, many of the imputed values are zero.

```{r}
nonimputed <- cbind(myMean, myMedian)
imputed <- cbind(impMyMean, impMyMedian)
table <- rbind(nonimputed, imputed)
row.names(table) <- c("nonimputed", "imputed")
```

**Table 1: Compares imputed mean and median vs non-imputed mean and median.**
```{r table}
table
```

## Are there differences in activity patterns between weekdays and weekends?

**Goal: Create a new factor variable in the dataset with two levels, "weekday" and "weekend," indicating whether a given date is a weekday or weekend day.**

## Approach
I first took the data and created a new column using mutate for the day of the week. I then used a for loop and gsub to change the days of the week to weekday or weekend and saved it in a new table

```{r weekdays}
byWeekType <- mutate(act, WeekType = weekdays(act$date, abbreviate=FALSE))
weekDay <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday")
weekEnd <- c("Saturday", "Sunday")

for (day in 1:5){
    byWeekType$WeekType <- gsub(weekDay[day], "Weekday", byWeekType$WeekType)
}
    
for (day in 1:2){
    byWeekType$WeekType <- gsub(weekEnd[day], "Weekend", byWeekType$WeekType)
}

Weekday_final <- filter(byWeekType, WeekType == "Weekday")
Weekend_final <- filter(byWeekType, WeekType == "Weekend")
```


Make a panel plot containing a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). 


```{r panelPlot}
## Weekday Panel
par(mfrow = c(2, 1), mar = c(4, 5, 2, 1))
weekday_panel <- group_by(Weekday_final, interval) %>%
    summarize(meanSteps=mean(steps, na.rm=T))
max1 = max(weekday_panel$meanSteps)
maxStepInterval1 <- filter(weekday_panel, meanSteps %in% max1)
maxStepInterval1<-as.data.frame(maxStepInterval1)

plot(weekday_panel$interval, weekday_panel$meanSteps, type="l", xlab="Interval", ylab="Steps", col = "42", main = "Average Weekday Daily Activity Pattern")
abline(v = maxStepInterval1$interval, col = "purple", lwd = "3")

## Weekend Panel
weekend_panel <- group_by(Weekend_final, interval) %>%
    summarize(meanSteps=mean(steps, na.rm=T))
max2 = max(weekend_panel$meanSteps)
maxStepInterval2 <- filter(weekend_panel, meanSteps %in% max2)
maxStepInterval2 <-as.data.frame(maxStepInterval2)

plot(weekend_panel$interval, weekend_panel$meanSteps, type="l", xlab="Interval", ylab="Steps", col = "42", main = "Average Weekend Daily Activity Pattern")
abline(v = maxStepInterval2$interval, col = "purple", lwd = "3")

```

I tried to think of a way to create this table using facet, but I couldn't figure out how to keep weektype after running the function summary. 
