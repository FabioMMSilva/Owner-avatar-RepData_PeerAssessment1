---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r getdata}
rm (list=ls())
setwd("~/GitHub/RepData_PeerAssessment1")
steps <- read.table(unz("activity.zip", "activity.csv"), header=T, quote="\"",           sep=",")
summary(steps)
library('dplyr')
steps.per.day <- steps %>% group_by(date) %>% summarize(sum=sum(steps, na.rm=T))
hist(steps.per.day$sum, col="blue", main="Steps per Day Histogram", xlab = "steps per day", breaks=12)
abline(v=mean(steps.per.day$sum, na.rm=T), col="red", lwd=3)
abline(v=median(steps.per.day$sum, na.rm=T), col="green", lwd=3) 
legend("topright", lwd=c(3,3), col=c("red", "green"),   
    legend=c(paste("mean: ",signif(mean(steps.per.day$sum, na.rm=T),6)),
             paste("median: ",signif(median(steps.per.day$sum, na.rm=T),6))
            )
    )

steps$intfactor <- factor(format(steps$interval,digits=4))

steps.per.interval <- steps %>% group_by(interval) %>% 
  summarize(avg=mean(steps, na.rm=T))

with(steps.per.interval, plot(interval, avg,type="l", 
    main="Average steps per 5 minute interval", ylab="average number of steps",
    xlab="time interval"))
avgmax <- steps.per.interval[which.max(steps.per.interval$avg),]$interval
abline(v=avgmax, col="red")
legend("topright", lwd=c(1,1), col=c("black","red"),   
    legend=c("Avg steps per interval",
             paste("Maximum at interval", avgmax)))
    
missing <- is.na(steps)
total.missing <- sum(missing)

# make new df with the average steps per interval as a new column
new.steps <- merge(steps, steps.per.interval, by="interval")
# add a new column 'imputed' that checks if the original steps is na, and then uses 
# the average if it is na
new.steps$imputed <- ifelse(is.na(new.steps$steps),new.steps$avg,new.steps$steps)

new.steps.per.day <- new.steps %>% group_by(date) %>% summarize(sum=sum(imputed, na.rm=T))
hist(new.steps.per.day$sum, col="blue", main="Imputed Steps per Day Histogram", 
     xlab = "steps per day", breaks=12)
abline(v=mean(new.steps.per.day$sum, na.rm=T), col="red", lwd=3)
abline(v=median(new.steps.per.day$sum, na.rm=T), col="green", lwd=3) 
legend("topright", lwd=c(3,3), col=c("red", "green"),   
    legend=c(paste("mean: ",signif(mean(new.steps.per.day$sum),6)),
             paste("median: ",signif(median(new.steps.per.day$sum),6))
            )
      )

steps$dayofweek <- factor(weekdays(as.Date(as.character(steps$date),'%Y-%m-%d')), 
                          levels=c("Sunday","Monday","Tuesday",
                                   "Wednesday","Thursday",
                                   "Friday","Saturday")
                          )
steps$weekend <- factor(ifelse(steps$dayofweek %in% c("Saturday","Sunday"), "weekend", "weekday"))

steps.per.weekday <- steps %>% group_by(dayofweek) %>% 
    summarize(avg=mean(steps, na.rm=T))

steps.per.weekend <- steps %>% group_by(weekend,interval) %>% 
         summarize(avg=mean(steps, na.rm=T))

with(steps.per.weekend[steps.per.weekend$weekend == "weekday",], 
     plot(interval, avg, type="l", col="red", 
     main="Average Steps per interval -- Weekend vs. Weekday", xlab="Interval", ylab="Avg Steps" ))
with(steps.per.weekend[steps.per.weekend$weekend == "weekend",], points(interval, avg, type="l", col="blue"))
legend("topright", lwd=c(1,1), col=c("red","blue"), legend=c("weekday","weekend"))


```

