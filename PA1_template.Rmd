---
title: "Reproducible Research Project Assignment 1"
author: "Mark De La Mater"
date: "November 19, 2017"
output: html_document
---

### Loading and Preparing the Data
```{r Data_Preparation, message = FALSE, warning= FALSE}
require(dplyr)
require(ggplot2)

## record the default directory
home <- getwd()

## Set the path and source file name and read the csv data in as a date frame
source.directory <- "C:/Users/Mark De La Mater/Desktop/RR_Assignments/RR_Wk2"
source.file <- "activity.csv"
setwd(source.directory)
df <- read.csv(source.file)

## modify the original data frame to inlcude
## date in internal date format
## a factor variable indicating if the day is a Weekday or a Weekend
## a logical value indicating is the recored has missing step data
## a key for dermining the value to replace missing data
df <- mutate(df, date2 = as.Date.character(date)) 
df <- mutate(df, weekday = weekdays(date2))
df <- mutate(df, day.type = as.factor(ifelse(weekday == "Saturday" | weekday == "Sunday", 
                                             "Weekend", "Weekday")))
df <- mutate(df, steps.missing = is.na(steps))
df <- mutate(df, interval_fixed = sprintf("%04d", interval))
df <- mutate(df, data.impute.key = paste(weekday, "-", interval_fixed, sep = ""))
```
### What is the mean total number of steps taken per day?
#### Here we are ignoring missing data
```{r Total Steps per Day}
## Here we group the data by date and then generate a historgam
df_grp <- group_by(df, date)
df_grp_sum <- summarize(df_grp,
                        count = n(),
                        steps.total = sum(steps, na.rm = TRUE),
                        steps.mean = mean(steps, na.rm = TRUE),
                        steps.median = median(steps, na.rm = TRUE)
                        )

g <- ggplot(data = df_grp_sum, mapping = aes(x = steps.total))
g <- g + geom_histogram(binwidth = 2000)
g <- g + ggtitle("Total Steps Taken per Day - Without Imputing Missing Values")
g <- g + xlab("Total Steps per Day")
print(g)

```

#### Mean Number of Steps Taken per Day - Ignoring Missing Data
```{r}
print(mean(df_grp_sum$steps.total))
```

#### Median Number of Steps Taken per Day - Ignoring Missing Data
```{r}
print(median(df_grp_sum$steps.total))
```

### What is the average daily activity pattern ... across all days - Ignoring Missing Data?
```{r Average Daily Activity}
## Group the data by interval and the calculated the average steps
df_grp2 <- group_by(df, interval)
df_grp2_sum <- summarize(df_grp2,
                         steps.average = mean(steps, na.rm = TRUE),
                         )

g2 <- ggplot(data = df_grp2_sum, mapping = aes(x = interval, y = steps.average))
g2 <- g2 + geom_point()
g2 <- g2 + geom_line()
g2 <- g2 + ggtitle("Average Number of Steps Taken per Interval - Without Imputing Missing Values")
g2 <- g2 + ylab("Average Number of Steps per 5 Minute Interval")
print(g2)
```


#### The 5-minute Interval with the highest average number of steps
```{r}
## The Interval with the Highest Average Steps across all days
print(interval.with.max.steps <- filter(df_grp2_sum, steps.average == max(steps.average))$interval)
```

### Imputing missing values

#### The total number of observations with missing values
```{r}
## Total Rows in Dataset with Missing Data
print(sum(df$steps.missing))
```

#### A strategy for filling in missing data values

I decided to calculate the mean number of steps by Week Day and Interval.  I would then map missing data based on the Week Day and Interval of the observation.  In the Loading and Preparing Data section, a relational key column named data.impute.key was added to the data frame.  The key value = weekday-interval, where interval has been formatted as having 4 digits with leading zeros.

```{r Imputing Missing Data}
## Calculate the average number of steps by weekday and interval
df_grp3 <- group_by(df, data.impute.key)
df_grp3_sum <- summarize(df_grp3,
                         steps.average = mean(steps, na.rm = TRUE)
                         )
## join df and df_grp3_sum using the left_join() function of dplyr
imputed.df <- left_join(df, df_grp3_sum, by = "data.impute.key")
## replace only the missing values with the weekday-inteval keyed averages.
imputed.df <- mutate(imputed.df, steps.imputed = ifelse(steps.missing == TRUE, steps.average, steps))
```

#### Generate a new histogram of total number of steps taken each day using the dataset that now includes imputed values for any missing data
```{r}
## now generate a new histogram with the data frame that includes the imputed values
df_grp4 <- group_by(imputed.df, date)
df_grp4_sum <- summarize(df_grp4,
                        count = n(),
                        steps.total = sum(steps, na.rm = TRUE),
                        steps.imputed.total = sum(steps.imputed),
                        steps.delta = steps.imputed.total - steps.total,
                        steps.imputed.mean = mean(steps.imputed),
                        steps.imputed.median = median(steps.imputed)
                        )
df_grp4_sum <- mutate(df_grp4_sum, weekday = as.factor(weekdays(as.Date.character(date))))
df_grp4_sum$weekday <- factor(df_grp4_sum$weekday, levels = c("Monday", "Tuesday",
                                                              "Wednesday", "Thursday",
                                                              "Friday", "Saturday", 
                                                              "Sunday"))

g4 <- ggplot(data = df_grp4_sum, mapping = aes(x = steps.imputed.total))
g4 <- g4 + geom_histogram(binwidth = 2000)
g4 <- g4 + ggtitle("Total Steps Taken per Day - With Imputed Missing Data")
g4 <- g4 + xlab("Total Steps per Day (with Imputed Steps)")
print(g4)
```

#### Mean Number of Steps Taken per Day - Including Imputed Values
```{r}
print(mean(df_grp4_sum$steps.imputed.total))
```

#### Median Number of Steps Taken per Day - Including Imputed Values
```{r}
print(median(df_grp4_sum$steps.imputed.total))
```

#### Difference in mean number of steps per day for data with Imputed Values vs. data with only Recorded Values
```{r}
print(mean(df_grp4_sum$steps.imputed.total) - mean(df_grp_sum$steps.total))
```

#### Difference in median number of steps per day for data with Imputed Values vs. data with only Recorded Values
```{r}
print(median(df_grp4_sum$steps.imputed.total) - median(df_grp_sum$steps.total))
```

#### Impact of imputing missing data on the esimates of total daily number of steps
In reviewing the data, it was observed that missing observations occured for entire days.  There were no days 
where only a few observations were missing.  The recorded days either had no missing observations or all of
the observations were missing.  In total, there were 8 days with missing observations.  Tuesday had no missing
obervations.  All of the other weekdays had at least one occurance of missing observations.
This is shown in the bar chart below

```{r}
g4a <- ggplot(data = df_grp4_sum)
g4a <- g4a + geom_bar(
                      mapping = aes(x = date, y = steps.delta, fill = weekday),
                      stat = "identity"
                      )  
g4a <- g4a + ggtitle("Difference Between Total Imputed Steps vs. Total Recored Steps by Date")

print(g4a)
```


As the result of imputing missing data, the estimates of total daily number of steps increased by ...
```{r}
## Difference in total number of steps taken
print(sum(df_grp4_sum$steps.delta))
```

### Are there differences in activty patterns between weekdays and weekends?
#### Here we will revert back to the original dataset that does not inlcude imputed values for missing data

```{r}
## here we group the original dataset by day.type and interval
df_grp5 <- group_by(df, day.type, interval)
df_grp5_sum <- summarize(df_grp5,
                         steps.average = mean(steps, na.rm = TRUE)
                         )

g5 <- ggplot(data = df_grp5_sum, mapping = aes(x = interval, y = steps.average))
g5 <- g5 + geom_point()
g5 <- g5 + geom_line()
g5 <- g5 + facet_wrap(~day.type, nrow = 2)  ## add a paneled layout with separate panels for Weekday and Weekend
g5 <- g5 + ggtitle("Average Number of Steps Taken per Interval by Type of Day \n Without Imputing Missing Values")
g5 <- g5 + ylab("Average Number of Steps per 5 Minute Interval")
print(g5)
```


####It does look like activity starts and ends earlier on weekdays than on weekends.
####There also appears to be differences in the pattern of activity








