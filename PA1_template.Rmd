---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
```{r}
library(data.table)
options(scipen=999)
if (!file.exists('activity.csv')){
  if (!file.exists('activity.zip')){
    download.files('https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip',
                   destfile='activity.zip',method='curl')}
  unzip('activity.zip')
}
activity <- fread('activity.csv', sep=',', header=T, na.strings='NA')
activity$date <- as.Date(activity$date)
```


## What is mean total number of steps taken per day?
```{r,fig.height=4,fig.width=6}
library(dplyr)
library(ggplot2)
activitystat <- activity %>% group_by(date) %>% select(-interval) %>% 
  summarise(steptotal = sum(steps,na.rm=T))
head(activitystat,5)
ggplot(data=activitystat,mapping=aes(steptotal))+
  geom_histogram(binwidth = 1000)+
  labs(x='Total number of steps', y='Frequency')
```
  
The mean total steps taken per day was `r round(mean(activitystat$steptotal,na.rm=T),1)` and the median was `r median(activitystat$steptotal,na.rm=T)`.  

## What is the average daily activity pattern?
```{r,fig.height=4,fig.width=6}
library(dplyr)
library(ggplot2)
activeperiod <- activity %>% group_by(interval) %>% select(-date) %>% 
  summarise(mean = mean(steps,na.rm=T))
ggplot(data=activeperiod,mapping=aes(interval,mean))+
    geom_line(size=1)+
    labs(x='Period', y='Mean number of steps')
```
  
Across all days, the maximum number of steps is taken within the 5-min interval up to `r activeperiod$interval[which.max(activeperiod$mean)]`.

## Imputing missing values
There are `r sum(!complete.cases(activity))` rows with missing values(s). To impute these, the average of the steps taken in that period across days were computed.
```{r,fig.height=4,fig.width=6}
library(dplyr)
activity$imputeSteps <- ave(activity$steps,activity$interval,FUN=function(x)
  ifelse(is.na(x),mean(x,na.rm=T),x))
activityimpstat <- activity %>% group_by(date) %>% select(date,imputeSteps) %>% 
  summarise(steptotal = sum(imputeSteps))
ggplot(data=activityimpstat,mapping=aes(steptotal))+
  geom_histogram(binwidth = 1000)+
  labs(x='Total number of steps', y='Frequency')
head(activityimpstat,5)
```
  
The resulting mean and median steps per day from the imputation was `r round(mean(activityimpstat$steptotal,na.rm=T),1)` and `r round(median(activityimpstat$steptotal,na.rm=T),1)`. The differences between the imputed and non-imputed data for these parameters are `r round(abs(mean(activityimpstat$steptotal,na.rm=T)- mean(activitystat$steptotal,na.rm=T)),1)` and `r round(abs(median(activityimpstat$steptotal,na.rm=T)-median(activitystat$steptotal,na.rm=T)),1)`. 


## Are there differences in activity patterns between weekdays and weekends?
```{r,fig.height=5,fig.width=6}
library(ggplot2)
library(dplyr)
weekdays = c('Monday','Tuesday','Wednesday','Thursday','Friday')
weekend = c('Saturday','Sunday')
activity$day <- factor(weekdays(activity$date),levels=c(weekdays,weekend),
                       labels=c(rep('weekday',5),rep('weekend',2)))
activityimpstat <- activity %>% group_by(day,interval) %>% select(date,interval:day) %>% 
  summarise(mean = mean(imputeSteps))
ggplot(data=activityimpstat,mapping=aes(interval,mean))+
  geom_line(size=1)+
  facet_grid(day~.)+
  labs(x='Interval',y='Average number of steps')
```
